Bootstrap: docker
From: ubuntu:25.10


%environment
    export LC_ALL=C
    . /opt/software/conda/bin/activate /opt/software/conda_env
    #bash $HOME/.cargo/env

%post
    SINGULARITY_SHELL=/bin/bash
    apt-get update
    apt install -y build-essential

    apt-get install -y libz-dev wget make curl fastp bc
    apt-get install -y fastqc kraken2 bamtools mash fastani ariba kmc skesa rna-star spades
    #snippy not yet in ubuntu

    #for bascet compilation
    apt-get install -y git cmake libhdf5-serial-dev libclang-dev 



    mkdir -p /opt/software

    cd /opt/software
    curl -O https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh
    sh ./Miniconda3-latest-Linux-x86_64.sh -p /opt/software/conda -b

    /opt/software/conda/bin/conda config --add channels defaults
    /opt/software/conda/bin/conda config --add channels conda-forge
    /opt/software/conda/bin/conda config --add channels bioconda 

    /opt/software/conda/bin/conda tos accept --override-channels --channel conda-forge
    /opt/software/conda/bin/conda tos accept --override-channels --channel bioconda
    /opt/software/conda/bin/conda tos accept --override-channels --channel https://repo.anaconda.com/pkgs/main
    /opt/software/conda/bin/conda tos accept --override-channels --channel https://repo.anaconda.com/pkgs/r

    /opt/software/conda/bin/conda create -p /opt/software/conda_env -y abricate bakta checkm-genome cellsnp-lite diamond gecco genomad gtdbtk mlst \
	mmseqs2 ncbi-amrfinderplus prokka quast skani tabix trust4 vireosnp snippy
    #fastp fastqc kraken2 bamtools mash fastani ariba kmc skesa snippy star spades
    #snippy not yet in ubuntu

    # pip install vireoSNP
    # 

    ########## Bascet dependencies

    mkdir -p /src
    cd /src
    curl https://sh.rustup.rs -sSf | sh -s -- -y

    #enable rustup
    . "$HOME/.cargo/env"

    #install nightly toolchain
    rustup toolchain install nightly


%runscript
    exec "$@"
