Bootstrap: localimage
From: deps.sif


%environment
    . "$HOME/.cargo/env"

%files
    ../src              /src/bascet/src
    ../assets           /src/bascet/assets
    ../bascet-core      /src/bascet/bascet-core
    ../bascet-derive    /src/bascet/bascet-derive
    ../bascet-io        /src/bascet/bascet-io
    ../bascet-variadic  /src/bascet/bascet-variadic
    ../bascet-runtime   /src/bascet/bascet-runtime
    ../.cargo           /src/bascet/.cargo
    ../Cargo.toml       /src/bascet/Cargo.toml

%post
    SINGULARITY_SHELL=/bin/bash

    ### build bascet
    . "$HOME/.cargo/env"
    cd /src/bascet
    cargo +nightly build --profile=release
    #cargo +nightly build

    ### link bascet to where it should be
    cp /src/bascet/target/release/bascet /bin/bascet
    #cp /src/bascet/target/debug/bascet /bin/bascet

    ### cleanup
    rm -Rf /src/bascet

%runscript
    exec "$@"
