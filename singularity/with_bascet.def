Bootstrap: localimage
From: bascet_container.sif


%environment
    export LC_ALL=C
    . /opt/software/conda/bin/activate /opt/software/conda_env

%files
    ../src /src/bascet/src
    ../Cargo.toml /src/bascet/Cargo.toml

%post
    SINGULARITY_SHELL=/bin/bash

    apt-get install -y git cmake libhdf5-serial-dev libclang-dev


    mkdir -p /src
    cd /src
    #curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
    curl https://sh.rustup.rs -sSf | sh -s -- -y
    #enable rustup
    . "$HOME/.cargo/env"   

    #install nightly toolchain
    rustup toolchain install nightly

    ### get bascet
    #git clone git@github.com:henriksson-lab/bascet.git
	#https://github.com/henriksson-lab/bascet

    ### build bascet    
    cd /src/bascet
    cargo +nightly build

    ### link bascet to where it should be    

    ln -s /src/bascet/target/debug/robert /bin/bascet

%runscript
    exec "$@"
